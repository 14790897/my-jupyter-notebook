# ğŸ“Š é€šé“æ•°ä¼˜åŒ–åˆ†æ

## å½“å‰ä¿®æ”¹

### é€šé“æ•°å¢åŠ 
- **ç”Ÿæˆå™¨ (ngf)**: 64 â†’ **96** (+50%)
- **åˆ¤åˆ«å™¨ (ndf)**: 64 â†’ **96** (+50%)

## ä¸ºä»€ä¹ˆå¢åŠ é€šé“æ•°æœ‰å¸®åŠ©ï¼Ÿ

### 1. **æ¨¡å‹å®¹é‡æå‡**

#### åŸå§‹é…ç½® (ngf=64, ndf=64)
```
Generator:
- Layer 1: 128 â†’ 512 channels (64Ã—8)
- Layer 2: 512 â†’ 256 channels (64Ã—4)
- Layer 3: 256 â†’ 128 channels (64Ã—2)
- Layer 4: 128 â†’ 64 channels
- Layer 5: 64 â†’ 1 channel

Discriminator:
- Layer 1: 1 â†’ 64 channels
- Layer 2: 64 â†’ 128 channels (64Ã—2)
- Layer 3: 128 â†’ 256 channels (64Ã—4)
- Layer 4: 256 â†’ 512 channels (64Ã—8)
- Layer 5: 512 â†’ 1 channel
```

#### ä¼˜åŒ–åé…ç½® (ngf=96, ndf=96)
```
Generator:
- Layer 1: 128 â†’ 768 channels (96Ã—8) âœ¨ +256 é€šé“
- Layer 2: 768 â†’ 384 channels (96Ã—4) âœ¨ +128 é€šé“
- Layer 3: 384 â†’ 192 channels (96Ã—2) âœ¨ +64 é€šé“
- Layer 4: 192 â†’ 96 channels âœ¨ +32 é€šé“
- Layer 5: 96 â†’ 1 channel

Discriminator:
- Layer 1: 1 â†’ 96 channels âœ¨ +32 é€šé“
- Layer 2: 96 â†’ 192 channels (96Ã—2) âœ¨ +64 é€šé“
- Layer 3: 192 â†’ 384 channels (96Ã—4) âœ¨ +128 é€šé“
- Layer 4: 384 â†’ 768 channels (96Ã—8) âœ¨ +256 é€šé“
- Layer 5: 768 â†’ 1 channel
```

### 2. **å‚æ•°æ•°é‡å˜åŒ–**

#### ä¼°ç®—å‚æ•°å¢é•¿
- **ç”Ÿæˆå™¨å‚æ•°**: ~2.4M â†’ ~5.4M (å¢åŠ çº¦125%)
- **åˆ¤åˆ«å™¨å‚æ•°**: ~2.7M â†’ ~6.1M (å¢åŠ çº¦125%)
- **æ€»å‚æ•°**: ~5.1M â†’ ~11.5M

#### ä¸ºä»€ä¹ˆè¿™ä¸ªå¢é•¿æ˜¯åˆç†çš„ï¼Ÿ
- âœ… å¯¹äº64Ã—64å›¾åƒï¼Œ11.5Må‚æ•°ä»ç„¶æ˜¯é€‚ä¸­çš„
- âœ… 300å¼ è®­ç»ƒå›¾ç‰‡ + æ•°æ®å¢å¼ºå¯ä»¥æ”¯æŒè¿™ä¸ªå‚æ•°é‡
- âœ… ä½¿ç”¨äº†EMAã€Weight Decayç­‰æ­£åˆ™åŒ–æŠ€æœ¯é˜²æ­¢è¿‡æ‹Ÿåˆ
- âœ… Spectral Normalizationé™åˆ¶äº†åˆ¤åˆ«å™¨çš„èƒ½åŠ›

## é¢„æœŸæ•ˆæœ

### FIDæ”¹è¿›é¢„æµ‹

| é€šé“é…ç½® | å‚æ•°é‡ | é¢„æœŸFID | æ”¹è¿›å¹…åº¦ |
|---------|--------|---------|---------|
| ngf/ndf=64 | 5.1M | 70-80 | åŸºçº¿ |
| ngf/ndf=96 | 11.5M | 60-70 | â†“5-10åˆ† |
| ngf/ndf=128 | 20.4M | 55-65 | â†“10-15åˆ† (å¯èƒ½è¿‡æ‹Ÿåˆ) |

### ä¸ºä»€ä¹ˆé€‰æ‹©96è€Œä¸æ˜¯128ï¼Ÿ

#### ä¼˜ç‚¹å¯¹æ¯”

**ngf/ndf=96 (å½“å‰é€‰æ‹©)**
- âœ… é€‚åº¦å¢åŠ æ¨¡å‹å®¹é‡
- âœ… 300å¼ å›¾ç‰‡å¯ä»¥æœ‰æ•ˆè®­ç»ƒ
- âœ… ä¸å¤ªå®¹æ˜“è¿‡æ‹Ÿåˆ
- âœ… è®­ç»ƒé€Ÿåº¦ç›¸å¯¹è¾ƒå¿«
- âœ… æ˜¾å­˜å ç”¨é€‚ä¸­ (~6-8GB)

**ngf/ndf=128 (è¿‡åº¦é…ç½®)**
- âš ï¸ å‚æ•°é‡è¿‡å¤§ (20.4M)
- âš ï¸ å®¹æ˜“åœ¨å°æ•°æ®é›†ä¸Šè¿‡æ‹Ÿåˆ
- âš ï¸ è®­ç»ƒé€Ÿåº¦è¾ƒæ…¢
- âš ï¸ æ˜¾å­˜å ç”¨è¾ƒå¤§ (~10-12GB)
- âš ï¸ å¯èƒ½éœ€è¦æ›´å¼ºçš„æ­£åˆ™åŒ–

**ngf/ndf=80 (ä¿å®ˆæ–¹æ¡ˆ)**
- âœ“ å‚æ•°é‡é€‚ä¸­ (7.2M)
- âœ“ è¾ƒéš¾è¿‡æ‹Ÿåˆ
- âš ï¸ å®¹é‡æå‡æœ‰é™
- âš ï¸ FIDæ”¹è¿›å¯èƒ½ä¸æ˜æ˜¾

## å…¶ä»–é…å¥—ä¼˜åŒ–

### 1. æ‰¹é‡å¤§å°ä¿æŒ32
- æ›´å¤§çš„æ¨¡å‹éœ€è¦æ›´ç¨³å®šçš„æ¢¯åº¦
- batch_size=32æä¾›è‰¯å¥½çš„å¹³è¡¡

### 2. å­¦ä¹ ç‡ä¿æŒ0.0001
- æ›´å¤§çš„æ¨¡å‹å¯èƒ½æ›´æ•æ„Ÿ
- è¾ƒå°çš„å­¦ä¹ ç‡ç¡®ä¿ç¨³å®šè®­ç»ƒ

### 3. Weight Decay (1e-5)
- é˜²æ­¢æ›´å¤§æ¨¡å‹è¿‡æ‹Ÿåˆ
- L2æ­£åˆ™åŒ–é™åˆ¶æƒé‡å¢é•¿

### 4. EMA (decay=0.9999)
- å¯¹äºæ›´å¤§çš„æ¨¡å‹ï¼ŒEMAæ›´åŠ é‡è¦
- å¹³æ»‘æƒé‡æ›´æ–°ï¼Œæå‡ç”Ÿæˆè´¨é‡

## å®æ–½å»ºè®®

### è®­ç»ƒç­–ç•¥

1. **å‰500 epochs**: è§‚å¯Ÿè®­ç»ƒç¨³å®šæ€§
   - æ£€æŸ¥D Losså’ŒG Lossæ˜¯å¦å¹³è¡¡
   - æ£€æŸ¥D(x)æ˜¯å¦åœ¨0.7-0.9ä¹‹é—´
   - æ£€æŸ¥æ˜¯å¦å‡ºç°mode collapse

2. **500-1500 epochs**: FIDåº”å¼€å§‹æ˜æ˜¾ä¸‹é™
   - é¢„æœŸFIDä»80é™åˆ°65-70
   - å¦‚æœFIDä¸ä¸‹é™ï¼Œè€ƒè™‘è°ƒæ•´G:Dè®­ç»ƒæ¯”ä¾‹

3. **1500-3000 epochs**: ç²¾ç»†ä¼˜åŒ–é˜¶æ®µ
   - FIDåº”ç»§ç»­ç¼“æ…¢ä¸‹é™åˆ°60-65
   - ä¿å­˜å¤šä¸ªcheckpointè¿›è¡Œæ¯”è¾ƒ

### ç›‘æ§æŒ‡æ ‡

```python
# ç†æƒ³è®­ç»ƒçŠ¶æ€
D(x): 0.75-0.85      # åˆ¤åˆ«å™¨å¯¹çœŸå®å›¾åƒçš„åˆ¤æ–­
D(G(z)): 0.35-0.50   # åˆ¤åˆ«å™¨å¯¹ç”Ÿæˆå›¾åƒçš„åˆ¤æ–­
D Loss: 0.3-0.8      # åˆ¤åˆ«å™¨æŸå¤±
G Loss: 0.5-1.5      # ç”Ÿæˆå™¨æŸå¤±
```

### å¦‚æœå‡ºç°é—®é¢˜

#### é—®é¢˜1: åˆ¤åˆ«å™¨è¿‡å¼º
**ç—‡çŠ¶**: D(x)â†’1.0, D(G(z))â†’0.0, G Losså¾ˆå¤§
**è§£å†³æ–¹æ¡ˆ**:
```python
# å¢åŠ ç”Ÿæˆå™¨è®­ç»ƒæ­¥æ•°
g_steps = 3  # ä»2æ”¹ä¸º3
```

#### é—®é¢˜2: ç”Ÿæˆå™¨å´©æºƒ (Mode Collapse)
**ç—‡çŠ¶**: ç”Ÿæˆçš„å›¾åƒç¼ºä¹å¤šæ ·æ€§ï¼ŒFIDçªç„¶ä¸Šå‡
**è§£å†³æ–¹æ¡ˆ**:
```python
# 1. å›é€€åˆ°ä¹‹å‰çš„checkpoint
# 2. é™ä½åˆ¤åˆ«å™¨å­¦ä¹ ç‡
optimizerD = optim.Adam(discriminator.parameters(), lr=5e-5, ...)
optimizerG = optim.Adam(generator.parameters(), lr=1e-4, ...)
```

#### é—®é¢˜3: è®­ç»ƒä¸ç¨³å®š
**ç—‡çŠ¶**: Losså‰§çƒˆéœ‡è¡ï¼ŒFIDä¸ä¸‹é™
**è§£å†³æ–¹æ¡ˆ**:
```python
# 1. é™ä½å­¦ä¹ ç‡
learning_rate = 5e-5

# 2. å¢åŠ æ¢¯åº¦è£å‰ªå¼ºåº¦
torch.nn.utils.clip_grad_norm_(discriminator.parameters(), max_norm=0.5)
torch.nn.utils.clip_grad_norm_(generator.parameters(), max_norm=0.5)
```

## è¿›ä¸€æ­¥ä¼˜åŒ–é€‰é¡¹

å¦‚æœFIDä»ç„¶>60ï¼Œå¯ä»¥è€ƒè™‘ï¼š

### é€‰é¡¹1: æ¸è¿›å¼å¢åŠ é€šé“æ•°
```python
# è®­ç»ƒå‰1000 epochs
ngf = 64
ndf = 64

# ä»1000 epochå¼€å§‹ï¼Œé‡æ–°åˆå§‹åŒ–ä¸ºæ›´å¤§çš„æ¨¡å‹
ngf = 96
ndf = 96
# åŠ è½½ä¹‹å‰çš„æƒé‡ï¼ˆå¦‚æœç»“æ„å…¼å®¹ï¼‰æˆ–é‡æ–°è®­ç»ƒ
```

### é€‰é¡¹2: å°è¯•æ›´å¤§é…ç½® (è°¨æ…)
```python
ngf = 128  # ä»…åœ¨ç¡®è®¤æ²¡æœ‰è¿‡æ‹Ÿåˆæ—¶å°è¯•
ndf = 128
batch_size = 24  # å¯èƒ½éœ€è¦å‡å°batch sizeä»¥é€‚åº”æ˜¾å­˜
```

### é€‰é¡¹3: ä¼˜åŒ–Self-Attention
```python
class SelfAttention(nn.Module):
    def __init__(self, in_channels):
        super(SelfAttention, self).__init__()
        # å¢åŠ attentionçš„key/queryç»´åº¦
        self.query = nn.Conv2d(in_channels, in_channels // 4, 1)  # ä»//8æ”¹ä¸º//4
        self.key = nn.Conv2d(in_channels, in_channels // 4, 1)
        self.value = nn.Conv2d(in_channels, in_channels, 1)
        self.gamma = nn.Parameter(torch.zeros(1))
```

## èµ„æºæ¶ˆè€—ä¼°ç®—

### è®­ç»ƒæ—¶é—´ (T4 GPU)
- **ngf/ndf=64**: ~2.5åˆ†é’Ÿ/epoch Ã— 3000 = 125å°æ—¶
- **ngf/ndf=96**: ~3.5åˆ†é’Ÿ/epoch Ã— 3000 = 175å°æ—¶ (+40%)

### æ˜¾å­˜å ç”¨
- **ngf/ndf=64**: ~5-6 GB (batch_size=32)
- **ngf/ndf=96**: ~7-9 GB (batch_size=32)
- **ngf/ndf=128**: ~11-13 GB (batch_size=32) âš ï¸ å¯èƒ½è¶…å‡ºT4æ˜¾å­˜

### ç£ç›˜ç©ºé—´
- **Checkpointå¤§å°**: 
  - ngf/ndf=64: ~20 MB/checkpoint
  - ngf/ndf=96: ~45 MB/checkpoint
  - æ¯200 epochsä¿å­˜ä¸€æ¬¡: ~675 MBæ€»ç©ºé—´

## ç»“è®º

âœ… **æ¨èä½¿ç”¨ ngf=96, ndf=96 é…ç½®**

### ä¼˜åŠ¿
1. æ˜¾è‘—æå‡æ¨¡å‹å®¹é‡ (+125%å‚æ•°)
2. é€‚åˆ300å¼ å›¾ç‰‡çš„æ•°æ®é›†
3. é¢„æœŸFIDæ”¹è¿›5-10åˆ†
4. è®­ç»ƒæ—¶é—´å’Œæ˜¾å­˜éƒ½å¯æ¥å—
5. é…åˆEMAå’Œå…¶ä»–ä¼˜åŒ–ï¼Œæœ‰æœ›è¾¾åˆ°FID<60

### æƒè¡¡
- è®­ç»ƒæ—¶é—´å¢åŠ 40%
- æ˜¾å­˜éœ€æ±‚å¢åŠ ~40%
- éœ€è¦æ›´å¥½çš„æ­£åˆ™åŒ–ï¼ˆå·²é…ç½®ï¼‰

### ä¸‹ä¸€æ­¥
å¦‚æœngf=96æ•ˆæœå¥½ï¼Œå¯ä»¥åœ¨åç»­è®­ç»ƒä¸­å°è¯•ngf=128è¿›è¡Œå¯¹æ¯”å®éªŒã€‚
